#!/bin/bash
if [[ $BITBUCKET_DEPLOYMENT_ENVIRONMENT == production ]]
then
    echo "production"
    domain=frontend.$DOMAIN

elif [[ $BITBUCKET_DEPLOYMENT_ENVIRONMENT == staging ]]
then
    echo "staging"
    domain=frontend.$BITBUCKET_DEPLOYMENT_ENVIRONMENT.$DOMAIN
    sed -i "s/demo.drah.im/staging.demo.drah.im/g" src/assets/appconfig.production.json
    
elif [[ $BITBUCKET_DEPLOYMENT_ENVIRONMENT == dev ]]
then
    echo "dev"
    domain=frontend.$BITBUCKET_DEPLOYMENT_ENVIRONMENT.$DOMAIN
    sed -i "s/demo.drah.im/dev.demo.drah.im/g" src/assets/appconfig.production.json
fi

export space_deployment_path=deployment/$BITBUCKET_REPO_SLUG/$BITBUCKET_BUILD_NUMBER.$BITBUCKET_STEP_RUN_NUMBER.$domain

sed -i "s/SPACE_ACCESS_KEY/$SPACE_ACCESS_KEY/g" $BITBUCKET_CLONE_DIR/ci-scripts/etc/.s3cfg
sed -i "s/SPACE_SECRET_KEY/$SPACE_SECRET_KEY/g" $BITBUCKET_CLONE_DIR/ci-scripts/etc/.s3cfg
sed -i "s/SPACE_NAME/$SPACE_NAME/g" $BITBUCKET_CLONE_DIR/ci-scripts/etc/.s3cfg

# update ci-scripts/deploy.sh this for general deployment 
echo "update ci-scripts/deploy.sh this for general deployment"

sed -i "s/SPACE_NAME/$SPACE_NAME/g" ci-scripts/deploy.sh
sed -i "s/DOMAIN/$domain/g" ci-scripts/deploy.sh
sed -i "s/BITBUCKET_BUILD_NUMBER/$BITBUCKET_BUILD_NUMBER/g" ci-scripts/deploy.sh
sed -i "s/BITBUCKET_STEP_RUN_NUMBER/$BITBUCKET_STEP_RUN_NUMBER/g" ci-scripts/deploy.sh
sed -i "s/BITBUCKET_REPO_SLUG/$BITBUCKET_REPO_SLUG/g" ci-scripts/deploy.sh

alias attach='ssh "$SSH_USER"@"$IP" -p "$SSH_PORT" -o StrictHostKeyChecking=no'

echo Done!